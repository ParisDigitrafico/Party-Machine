(function($,window,document,undefined){var self=this;var defaults={speed:500,lapping:50,width:800,modal:true,iframe:false,type:"get",href:"",url:"",title:"",onLoad:function(){},onOpen:function(){},onClose:function(){},onError:function(){},onDestroy:function(){},onRefresh:function(){}};$.fn.crmPanel=function(options){var panel={},aPanel=[{id:"pp0",status:true,caller:"",title:"ptitle_pp0"},{id:"pp1",status:true,caller:"",title:"ptitle_pp1"},{id:"pp2",status:true,caller:"",title:"ptitle_pp2"},{id:"pp3",status:true,caller:"",title:"ptitle_pp3"}];var $body=$("body"),$overlay=$(".overlay"),$panel=$(".panel_modal"),wrapper="body",_msg;var init=function(){$body.on("click",".npanel, .panel_modal, .crmPanelTitle, #again, #Notificaciones, #user",function(e){e.stopPropagation()});$body.on("click",".CLOSE_AJAX",function(e){e.preventDefault();e.stopPropagation();var id=$(this).closest(".panel_modal").attr("id");$.crmPanel.close(id);$("#ptitle_"+id).prev(".crmPanelTitle").removeClass("BotonSecundario").addClass("BotonPrimario")});$body.on("click","#closeAll",function(e){e.preventDefault();e.stopPropagation();$.crmPanel.close("pp0");$(this).addClass("clicked")});$body.on("click","#closeAll",function(e){e.preventDefault();e.stopPropagation();$.crmPanel.close("pp0");$(this).addClass("clicked")});$body.on("click",".crmPanelTitle",function(e){e.preventDefault();e.stopPropagation();var $this=$(this);if($this.hasClass("BotonPrimario")){return}else if($this.hasClass("BotonSecundario")){var gid=$this.attr("id"),arr=gid.split("_"),$id=$("#"+arr[1]),next=$id.nextAll(".panel_modal").attr("id");$.crmPanel.close(next);$this.removeClass("BotonSecundario").addClass("BotonPrimario")}});$(document).on("click keyup",function(e){if($(".panel_modal").length&&$(e.target)[0]!=$("#Rutas")[0]&&$(e.target).attr("id")!="again"){var id=$(".panel_modal.popened.active:last").prop("id");if(e.type=="keyup"&&e.keyCode!=27){return}if(!$("#"+id).hasClass("vtnmodal")){$.crmPanel.close(id);$("#ptitle_"+id).prev(".crmPanelTitle").removeClass("BotonSecundario").addClass("BotonPrimario")}}});window.crmPanelInicializado=true};$.crmPanel=function(options,$aCaller){var _loaded=null;panel.settings=$.extend({},defaults,options);if(!panel.settings.href||!panel.settings.title){_msg="href or tittle are missing!";_loaded=false}else{if($(".panel_modal").length<4){$(".panel_modal").removeClass("active");var obj=_getId(),id=obj.id,status=obj.obj.status,caller=obj.obj.caller;var who;if($aCaller){who=$aCaller.attr("id");$aCaller.attr("data-panel",id)}_loaded=_create(id,who,panel.settings);return id}else{_msg="Debug info: CanÂ´t add more than 4 panels!";_loaded=false}}if(typeof panel.settings.onError=="function"&&_loaded===false){panel.settings.onError.call(this,_msg)}};var _open=function(aId){var aSettings={};aSettings=$.extend({},defaults,$("#"+aId).data("data-panel-settings"));var id=aId,$ele=$("#"+id),to=$ele.prevAll(".panel_modal.opened:first"),_opened=[];_opened.push(id);if($ele.length===0){if(typeof aSettings.onError=="function"){aSettings.onError.call(this,"Debug info: Panels "+id+" were not found!")}return}else{_animate($ele,"open",true);if(typeof aSettings.onOpen=="function"){aSettings.onOpen.call(this,"Debug info Open: Panels "+_opened+" opened.")}}};$.crmPanel.close=function(aId){$.crmPanel.showLoader(aId);var aSettings={};aSettings=$.extend({},defaults,$("#"+aId).data("data-panel-settings"));var id=aId,$ele=$("#"+id),to=$ele.nextAll(".panel_modal"),_closed=[];_closed.push(id);if($ele.length===0){if(typeof aSettings.onError=="function"){aSettings.onError.call(this,"Debug info Close: Panels "+id+" were not found!")}return}else{var $el;if(to.length){for(var i=0,j=to.length;i<j;i++){$el=$(to[i]);_closed.push($el.attr("id"));_animate($el,"close")}}$("#ptitle_"+id).prev(".crmPanelTitle").removeClass("BotonSecundario").addClass("BotonPrimario");_animate($ele,"close",true);if(typeof aSettings.onClose=="function"){if(!aSettings.iframe){var ajax=$("#"+aId).data("xhr-ajax-panel");if(typeof ajax=="object"){if(ajax.readyState!==4){ajax.abort()}}}aSettings.onClose.call(this,"Debug info: Panels "+_closed+" closed.")}}};$.crmPanel.refresh=function(aId,options){var aSettings={};if(typeof options!="object"){options={}}aSettings=$.extend({},defaults,$("#"+aId).data("data-panel-settings"),options);$("#"+aId).data("data-panel-settings",aSettings);var id=aId,$ele=$("#"+id),to=$ele.nextAll(".panel_modal");if($ele.length===0){if(typeof aSettings.onError=="function"){aSettings.onError.call(this,"Debug info refresh: Panels "+id+" were not found!")}return}else{if(aSettings.iframe){$("#"+id).html('<div class="crm-loader"></div>');$.crmPanel.loadFrame(id,aSettings.href)}else{$body.find("#"+id).html('<div class="crm-loader"></div>');$.crmPanel.loadAjax(id,aSettings.href)}}};$.crmPanel.showLoader=function(aId){var aSettings={};aSettings=$.extend({},defaults,$("#"+aId).data("data-panel-settings"));var id=aId,$ele=$("#"+id);if($ele.length===0){if(typeof aSettings.onError=="function"){aSettings.onError.call(this,"Debug info showLoader: Panels "+id+" were not found!")}}else{$("#"+id).find(".crm-loader").show()}};$.crmPanel.hideLoader=function(aId){var aSettings={};aSettings=$.extend({},defaults,$("#"+aId).data("data-panel-settings"));var id=aId,$ele=$("#"+id);if($ele.length===0){if(typeof aSettings.onError=="function"){aSettings.onError.call(this,"Debug info hideLoader: Panels "+id+" were not found!")}}else{$("#"+id).find(".crm-loader").hide()}};CLOSE_PANEL=function(aId){var id=aId.split("_");$.crmPanel.close(id[1])};REFRESH_PANEL=function(aId){var id=aId.split("_");$.crmPanel.refresh(id[1])};$.crmPanel.loadAjax=function(aId,aUrl){var aSettings={};aSettings=$.extend({},defaults,$("#"+aId).data("data-panel-settings"));var $id=$("#"+aId),seco=$("<div />",{id:"secondary",class:"scrollable"}).css({padding:"30px 20px 30px 40px"}),_loaded;$id.prepend(seco);$id=$id.find("#secondary");var ajax=$.ajax({url:aUrl,type:aSettings.type,beforeSend:function(){$("#"+aId).find(".crm-loader").show()}});$("#"+aId).data("xhr-ajax-panel",ajax);ajax.done(function(data){if(data.indexOf("CRM_ERROR_SESSION_EXPIRADA")==-1){$id.html(data);if(typeof aSettings.onLoad=="function"){aSettings.onLoad.call(this,"Ajax loaded");_load_v_tabs($id)}if(typeof aSettings.onRefresh=="function"){aSettings.onRefresh.call(this,"Ajax refresh");_load_v_tabs($id)}}else{var htmlError="<p>&nbsp;</p>";htmlError+='<div id="ntb0" class="notibar notibar-error" style="display: block; top: 0px; opacity: 1;">';htmlError+='<p class="notibar-text">'+CRMConfig.Etiqueta.txt_alerta_error_sesion_expirada+"</p>";htmlError+="</div>";htmlError+='<p align="center"><input type="button" class="crm-btn-small btnAceptarSessionExpirada" value="Aceptar" /></p>';$id.html(htmlError);$id.find(".btnAceptarSessionExpirada").click(function(){window.location=window.location.href})}});ajax.fail(function(data){var _status={404:function(){var rou='"'+aId+'","'+aUrl+'"';$id.html("<input id='again' onclick='javascript: $.crmPanel.loadAjax("+rou+");' class='crm-btn-medium' type='button' value='Reintentar'>")},500:function(){_debug("error:500")},0:function(){_debug("Sin conexion")}};_mySwitch(_status,data.status)();if(typeof aSettings.onLoad=="function"&&!_loaded){aSettings.onLoad.call(this,"Something happened! error:"+data.status)}});ajax.always(function(data){$("#"+aId).find(".crm-loader").hide()})};$.crmPanel.loadFrame=function(aId,aUrl){var aSettings={};aSettings=$.extend({},defaults,$("#"+aId).data("data-panel-settings"));var ajax=$.ajax({url:aUrl,type:aSettings.type});var $id=$("#"+aId),iframe=$("<iframe />").attr({name:"iframe_"+aId,src:aUrl,frameborder:0,hspace:0,onload:hideLoader(),onerror:showLoader1(aId)}).css({width:"100%",height:"100%"}),seco=$("<div />",{id:"secondary"}).css({"overflow-y":"hidden"});ajax.done(function(data){$id.css({overflow:"hidden"}).prepend(seco);$id.find("#secondary").html(iframe);$("#again").remove();if(typeof aSettings.onLoad=="function"){aSettings.onLoad.call(this,"iframe loaded")}});ajax.fail(function(data){var rou='"'+aId+'","'+aUrl+'"';$id.html("<input id='again' onclick='javascript: $.crmPanel.loadFrame("+rou+");' class='crm-btn-medium' type='button' value='Reintentar'>")})};var _destroy=function($aId){var aSettings={};aSettings=$.extend({},defaults,$aId.data("data-panel-settings"));var id=$aId.attr("id");to=$aId.nextAll(".panel_modal");_removed=[];$aId.stop().hide().remove();$("#ptitle_"+id).hide().stop().remove();_removed.push(id);$("#"+$aId.attr("data-caller")).removeClass("blocked");if(to.length){var $el;for(var i=0,j=to.length;i<j;i++){$el=$(to[i]);_removed.push($el.attr("id"));$el.stop().hide().remove();$("#"+$el.attr("data-caller")).removeClass("blocked");$("#ptitle_"+$el.attr("id")).hide().stop().remove()}}_setTrue(id);_activeLast();if($("#closeAll").hasClass("clicked")||$(".panel_modal").length===0){$("#closeAll").remove()}if($(".panel_modal").length===0){$(".overlay").hide();$body.removeClass("dontscroll")}if(id=="pp0"){$("#panelTitles").remove()}if(typeof aSettings.onDestroy=="function"){aSettings.onDestroy.call(this,"Debug info: Panels destroyed: "+_removed)}};var _create=function(aId,aCaller,aSettings){var id=aId,$ele=$("#"+id),lapping=_getLapping();if(!$ele.length){$("<div />",{id:id,class:_getClass(aSettings.modal),"data-right":lapping,"data-caller":aCaller}).css({display:"none",width:aSettings.width+"px"}).appendTo(wrapper);if(id=="pp0"){$("<div />",{id:"panelTitles"}).css({width:aSettings.width+"px",display:"none"}).html("<ul></ul>").appendTo(wrapper)}_makeTitles2(id,aSettings.title);status=true}else if($ele.length){status=false}else{status=undefined}if(!$(".overlay").length){$("<div/>",{class:"overlay"}).appendTo(wrapper)}if(!$body.hasClass("dontscroll")){$body.addClass("dontscroll")}if($("#"+id).length>0){$("#"+id).data("data-panel-settings",aSettings)}if(aSettings.iframe){$("#"+id).html('<div class="crm-loader"></div>');$.crmPanel.loadFrame(id,aSettings.href)}else{$body.find("#"+id).html('<div class="crm-loader"></div>');$.crmPanel.loadAjax(id,aSettings.href)}_open(id);return status};var _animate=function($aId,aDo,aLast){var aSettings={};aSettings=$.extend({},defaults,$aId.data("data-panel-settings"));var operation={open:function(){var id=$aId.attr("id");if(id=="pp0"){$("#panelTitles").show().animate({right:$aId.attr("data-right")},aSettings.speed,function(){})}$aId.removeClass("pclosed").addClass("popened").show().stop().animate({right:$aId.attr("data-right")},aSettings.speed,function(){if($aId.hasClass("vtnmodal")){$(".overlay").show()}else{$(".overlay").hide()}});if(aLast){$aId.addClass("active")}},close:function(){var id=$aId.attr("id");if(id=="pp0"){$("#panelTitles").show().animate({right:-$aId.outerWidth(true)},aSettings.speed,function(){})}$aId.removeClass("popened active").addClass("pclosed").stop().animate({right:-$aId.outerWidth(true)},aSettings.speed,function(){if($aId.hasClass("vtnmodal")&&$aId.prevAll(".panel_modal:first").hasClass("vtnmodal")||!$aId.hasClass("vtnmodal")&&$aId.prevAll(".panel_modal:first").hasClass("vtnmodal")){$(".overlay").show()}if($aId.hasClass("vtnmodal")&&!$aId.prevAll(".panel_modal:first").hasClass("vtnmodal")||!$aId.hasClass("vtnmodal")&&!$aId.prevAll(".panel_modal:first").hasClass("vtnmodal")){$(".overlay").hide()}_destroy($aId)})}};_mySwitch(operation,aDo)()};var _activeLast=function(){var $last=$(".panel_modal:last");if($last.hasClass("popened")){$last.addClass("active")}};var _getId=function(){var id=null,obj=null;for(var i=0,len=aPanel.length;i<len;i++){if(aPanel[i].status){obj=aPanel[i];id=obj.id;obj.status=false;break}}return{id:id,obj:obj}};var _getClass=function(aType){return aType?"panel_modal vtnmodal":"panel_modal"};var _getLapping=function(){return-($(".panel_modal").length*panel.settings.lapping)};var _debug=function(aShit){};var _setTrue=function(aId){for(var i=0,len=aPanel.length;i<len;i++){if(aPanel[i].id===aId){switch(i){case 0:if(!aPanel[i].status){aPanel[i].status=true;i++}else{break}case 1:if(!aPanel[i].status){aPanel[i].status=true;i++}else{break}case 2:if(!aPanel[i].status){aPanel[i].status=true;i++}else{break}case 3:if(!aPanel[i].status){aPanel[i].status=true}else{break}}break}}};var _makeTitles2=function(aId,aTitle){$("#panelTitles ul li").removeClass("BotonPrimario").addClass("BotonSecundario");$("#panelTitles ul").append('<li id="ptitle_'+aId+'" class="crmPanelTitle BotonPrimario">'+'<a href="#">'+aTitle+"</a>"+"</li>");if(!$("#closeAll").length){$("#panelTitles ul").prepend('<li id="closeAll" class="BotonSecundario">'+'<a href="#" class="ui-state-default ui-state-ryv-ajuste-close"><i class="fa fa-times" id="btnClosePanel"></i></a>'+"</li>");$("#panelTitles ul li#closeAll a").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})}};var _load_v_tabs=function($ppx){if($ppx.find(".vtabs").length>0){if($ppx.find(".area_input").length>0){$(window).resize(util.debouncer(function(evt){iWindowWidth=$(window).width();if(iWindowWidth<768){iNavHeight=$ppx.find("nav").outerHeight(true);iHeightAreaInput=$ppx.find(".area_input").outerHeight(true);iAux=iHeightAreaInput-iNavHeight+14;$ppx.find(".vtabs").css({height:iAux+"px"})}else{iWidthAreaInput=$ppx.find(".area_input").width();iHeightAreaInput=$ppx.find(".area_input").outerHeight(true);iWdt=iWidthAreaInput+50;iHgt=iHeightAreaInput-2;$ppx.find(".vtabs").css({width:iWdt+"px",height:iHgt+"px"})}},100));$(window).resize()}$ppx.find(".vtabs nav a").on("click",function(){_show_content($ppx,$(this).index());$ppx.find(".vtabs").find(".item").scrollTop(0)});_show_content($ppx,0)}};var _show_content=function($ppx,index){$ppx.find(".vtabs .item.visible").removeClass("visible");$ppx.find(".vtabs .item:nth-of-type("+(index+1)+")").addClass("visible");$ppx.find(".vtabs nav a.selected").removeClass("selected");$ppx.find(".vtabs nav a:nth-of-type("+(index+1)+")").addClass("selected")};var _mySwitch=function(aObj,aOpt){return aObj[aOpt]};var _setProperties=function($aElement){if($aElement.attr("data-speed")){panel.settings.speed=$aElement.attr("data-speed")}if($aElement.attr("data-lapping")){panel.settings.lapping=$aElement.attr("data-lapping")}if($aElement.attr("data-width")){panel.settings.width=$aElement.attr("data-width")}if($aElement.attr("data-modal")){panel.settings.modal=$aElement.attr("data-modal")==="true"?true:false}if($aElement.attr("data-iframe")){panel.settings.iframe=$aElement.attr("data-iframe")==="true"?true:false}if($aElement.attr("data-title")){panel.settings.title=$aElement.attr("data-title")}else{if(typeof panel.settings.onError=="function"){panel.settings.onError.call(this,"Debug info: data-title is missing")}}if($aElement.attr("data-url")){panel.settings.url=$aElement.attr("data-url")}if($aElement.attr("href")){panel.settings.href=$aElement.attr("href")}if($aElement.attr("data-href")){panel.settings.href=$aElement.attr("data-href")}};if(typeof window.crmPanelInicializado=="undefined"){window.crmPanelInicializado=false}if(window.crmPanelInicializado==false){init()}return this.each(function(){var $this=$(this);$this.on("click",function(e){e.preventDefault();$btn=$(e.target);panel.settings=$.extend({},defaults,options);_setProperties($this);var blocked={true:function(){$.crmPanel.close($this.attr("data-panel"))},false:function(){$.crmPanel(panel.settings,$btn)}};_mySwitch(blocked,$btn.hasClass("blocked"))();$btn.toggleClass("blocked")})})}})(jQuery,window,document);$("run").crmPanel();